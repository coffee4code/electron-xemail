var angular=require("angular"),remote=require("electron").remote,path=require("path");angular.module("app.controller",[]).controller("appCtrl",["$rootScope","$scope","$mdColors",function(a,b,c){}]).controller("menuCtrl",["$scope","$state","$mdDialog",function(a,b,c){function d(){b.go("app.open")}function e(){var b=c.confirm().title("关闭").textContent("确定退出应用程序？").ariaLabel("退出程序").targetEvent(event).ok("确定退出").cancel("取消");c.show(b).then(function(){a.window.close()},function(){return!1})}function f(){a.window.isMaximized()?a.window.unmaximize():a.window.maximize()}function g(){a.window.minimize()}function h(){a.window.webContents.openDevTools({mode:"detach"})}function i(){b.go("app.setting.user")}function j(a){l("help",a)}function k(a){l("about",a)}function l(a,b){c.show({controller:m,templateUrl:"tmpls/dialogs/dialog."+a+".html",parent:angular.element(document.body),targetEvent:b,clickOutsideToClose:!0,fullscreen:!1})}function m(a,b){a.hide=function(){b.hide()}}a.window=remote.getCurrentWindow(),a.onOpen=d,a.onExit=e,a.onMaximum=f,a.onDevTool=h,a.onMinimize=g,a.onSetting=i,a.onHelp=j,a.onAbout=k}]).controller("contentCtrl",["$scope",function(a){}]).controller("openCtrl",["$scope","$state","$filter","$mdToast",function(a,b,c,d){function e(b){var e=!1;return b&&b.path&&(e=c("filetype")(b.path,a.current.fileType.join(","))),e?(a.current.status=1,void(a.current.file=b)):(a.current.status=-1,d.show(d.simple().textContent("不支持的文件类型!").position("bottom center")),!1)}function f(){a.current.file&&b.go("app.sheet.load",{filePath:a.current.file.path})}a.current={status:0,fileType:["xls","xlsx"],file:null},a.onFileChange=e,a.onStart=f}]).controller("sheetCtrl",["$scope",function(a){a.current={progress:0,filePath:"",fileName:"",sheetName:""}}]).controller("sheetLoadCtrl",["$scope","$state","xlsxService","filePath",function(a,b,c,d){function e(){b.go("app.sheet.list")}a.current.progress=25,a.current.filePath=d,a.current.fileName=path.basename(d),a.sheetNames=c.load(d),a.onNext=e}]).controller("sheetListCtrl",["$scope","xlsxService",function(a,b){a.current.progress=50,a.rowList=b.list(a.current.sheetName),console.info(a.rowList)}]).controller("settingCtrl",["$scope",function(a){}]).controller("settingUserCtrl",["$scope","$mdToast","settingService","setting",function(a,b,c,d){function e(){c.setItemBatch({sender_email:a.setting.sender_email,sender_password:a.setting.sender_password,smtp_host:a.setting.smtp_host,smtp_port:a.setting.smtp_port}),b.show(b.simple().textContent("保存成功！").position("left bottom").hideDelay(3e3))}a.setting=d,a.current={status:1},a.onSave=e}]).controller("settingTemplateCtrl",["$scope","$mdToast","templateService","template",function(a,b,c,d){function e(){c.setAll(d),b.show(b.simple().textContent("保存成功！").position("left bottom").hideDelay(3e3))}a.template=d,a.current={status:1},a.onSave=e}]);var angular=require("angular");angular.module("app.directive",[]).directive("myDropZone",[function(){return{restrict:"A",scope:{onFileDrop:"="},link:function(a,b){b.bind("drop",function(b){b.stopPropagation(),b.preventDefault();var c=null;b&&b.dataTransfer&&b.dataTransfer.files&&b.dataTransfer.files.length&&(c=b.dataTransfer.files[0]),a.onFileDrop(c)}),b.bind("dragover",function(a){a.preventDefault(),$(this).addClass("drop-active")}),b.bind("dragleave",function(a){a.preventDefault(),$(this).removeClass("drop-active")}),$(window).bind("drop dragover",function(a){a.preventDefault()})}}}]).directive("myFilePicker",[function(){return{restrict:"EA",scope:{fileType:"=",myOnChange:"="},template:'<div>   <div class="drop-area" id="file-drop-area"  layout="column" flex layout-align="center center" my-drop-zone on-file-drop="onFileDrop">      <div class="drop-area-icon" layout="column" flex layout-align="center bottom">          <ng-md-icon icon="cloud_download" size="100" style="fill:{{$root.mdPrimaryColor}};"></ng-md-icon>      </div>      <div class="drop-area-tip" layout="column" layout-align="center center" flex ng-if="!!current.filePath" ng-bind="current.filePath"></div>      <div class="drop-area-tip" layout="column" layout-align="center center" flex ng-if="!current.filePath">点击选择xls文件或将文件拖放到这里</div>   </div>   <input id="file-input" type="file" my-on-change="onFileChange" style="display: none;"></div>',replace:!0,link:function(a,b,c){function d(b){a.current.filePath=b.path,a.$apply(function(){a.myOnChange(b)})}function e(){g.bind("change",function(b){a.$apply(function(){var c=null;b.target&&b.target.files&&b.target.files.length&&(c=b.target.files[0]),a.current.filePath=c.path,a.myOnChange(c)})}),h.bind("click",function(a){g.trigger("click")})}a.current={filePath:""},a.onFileDrop=d;var f=$(b),g=f.find("#file-input"),h=f.find("#file-drop-area");e()}}}]).directive("myInputUppercase",["$filter",function(a){return{restrict:"EA",require:"ngModel",link:function(a,b,c,d){function e(a){return(a||"").toUpperCase()}d.$parsers.push(e),d.$formatters.push(e)}}}]);var angular=require("angular"),ngRouter=require("angular-ui-router");angular.module("app.router",[ngRouter]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){c.hashPrefix("!"),b.otherwise("/open"),a.state("app",{url:"","abstract":!0,views:{menu:{templateUrl:"tmpls/menu.html",controller:"menuCtrl"},content:{templateUrl:"tmpls/content.html",controller:"contentCtrl"}}}).state("app.open",{url:"/open",views:{main:{templateUrl:"tmpls/pages/open.html",controller:"openCtrl"}}}).state("app.sheet",{url:"/sheet","abstract":!0,views:{main:{templateUrl:"tmpls/pages/sheet/sheet.html",controller:"sheetCtrl"}}}).state("app.sheet.load",{url:"/load?filePath",views:{step:{templateUrl:"tmpls/pages/sheet/load.html",controller:"sheetLoadCtrl",params:["filePath"],resolve:{filePath:["$stateParams",function(a){return a.filePath}]}}}}).state("app.sheet.list",{url:"/list",views:{step:{templateUrl:"tmpls/pages/sheet/list.html",controller:"sheetListCtrl"}}}).state("app.setting",{url:"/setting",absolute:!0,views:{main:{templateUrl:"tmpls/pages/setting/setting.html",controller:"settingCtrl"}}}).state("app.setting.user",{url:"/user",views:{list:{templateUrl:"tmpls/pages/setting/user.html",controller:"settingUserCtrl",resolve:{setting:["settingService",function(a){return a.getAll()}]}}}}).state("app.setting.template",{url:"/template",views:{list:{templateUrl:"tmpls/pages/setting/template.html",controller:"settingTemplateCtrl",resolve:{template:["templateService",function(a){return a.getAll()}]}}}})}]);var angular=require("angular"),XLSX=require("xlsx");angular.module("app.service",[]).service("xlsxService",["templateService",function(a){function b(a){return d=XLSX.readFile(a),console.info(d),d.SheetNames}function c(b){a.getAll();return e=d.Sheets[b]}var d=null,e=null;return{load:b,list:c}}]).service("templateService",["config","databaseService",function(a,b){function c(){var a="DROP TABLE IF EXISTS "+h+"; CREATE TABLE "+h+" (id INTEGER PRIMARY KEY AUTOINCREMENT, cell STRING, cellColumn STRING);",c=[];for(var d in g)c.push("INSERT INTO "+h+" VALUES (NULL, '"+d+"','"+g[d]+"')");b.create(h,a+c.join(";"))}function d(){var a={},c=b.table(h);return a=f(c)}function e(a){var c=[];for(var d in a)c.push("UPDATE "+h+' SET cellColumn="'+a[d]+'" WHERE cell="'+d+'"');return c=c.join(";"),b.execute(h,c)}function f(a){var b={};if(a&&a.length&&(a=a[0].values),a&&a.length)for(var c in a)b[a[c][1]]=a[c][2];return b}var g=a.get().TEMPLATES,h="template";return{init:c,getAll:d,setAll:e}}]).service("settingService",["config","databaseService",function(a,b){function c(){var a="DROP TABLE IF EXISTS "+k+"; CREATE TABLE "+k+" (id INTEGER PRIMARY KEY AUTOINCREMENT, itemKey STRING, itemValue STRING);",c=[];for(var d in j)c.push("INSERT INTO "+k+" VALUES (NULL, '"+d+"','"+j[d]+"')");b.create(k,a+c.join(";"))}function d(){var a={},c=b.table(k);return a=i(c)}function e(a){var c=null,d=b.filter(k,"SELECT * FROM "+k+" WHERE itemKey=:key;",{":key":a});return d&&(c={},c[d.itemKey]=d.itemValue),c}function f(a,c){return b.execute(k,"UPDATE "+k+' SET itemValue="'+c+'" WHERE itemKey="'+a+'";')}function g(a){var c=[];for(var d in a)c.push((c.length?" OR ":"")+' itemKey="'+a[d]+'" ');c=c.join(" "),c="SELECT * FROM "+k+" WHERE "+c;var e=b.execute(k,c),f=i(e);return f}function h(a){var c=[];for(var d in a)c.push("UPDATE "+k+' SET itemValue="'+a[d]+'" WHERE itemKey="'+d+'"');return c=c.join(";"),b.execute(k,c)}function i(a){var b={};if(a&&a.length&&(a=a[0].values),a&&a.length)for(var c in a)b[a[c][1]]=a[c][2];return b}var j=a.get().SETTINGS,k="setting";return{init:c,getAll:d,getItem:e,setItem:f,getItemBatch:g,setItemBatch:h}}]);var angular=require("angular");angular.module("app.config",[]).provider("config",[function(){function a(){return d}function b(a){d.SETTINGS=a}function c(a){d.TEMPLATES=a}var d={SETTINGS:{},TEMPLATES:{}};this.setSetting=b,this.setTemplate=c,this.$get=function(){return{get:a}}}]).config(["$mdThemingProvider",function(a){a.theme("default").primaryPalette("pink").accentPalette("orange")}]).config(["configProvider",function(a){var b={smtp_host:"smtp.qq.com",smtp_port:"465",sender_email:"1062893543@qq.com",sender_password:"anqckibffhrpbcef"},c={employee_email:"K",employee_name:"B",employee_department:"C",employee_workday:"R",employee_attendance:"T",wage_base:"L",wage_allowance:"M",wage_reward:"N",wage_everyday:"Q",wage_total:"O",deductions_absence:"U",deductions_sick_leave:"V",deductions_other:"W",deductions_social_security:"X",deductions_provident_fund:"Y",deductions_personal_tax:"Z",final_amount:"AC"};a.setSetting(b),a.setTemplate(c)}]);var angular=require("angular"),fs=require("fs"),SQL=require("sql.js"),path=require("path");angular.module("app.database",[]).service("databaseService",[function(){function a(a,b){if(!j||!j[a]){if(!e(a)){var c=new SQL.Database;return c.run(b),j[a]=c,h(a),!0}return!1}}function b(a,b,c){var d=null;if(g(a)&&f(a)){var e=j[a],h=e.prepare(b);d=h.getAsObject(c)}return d}function c(a,b){var c=null;if(g(a)&&f(a)){var d=j[a];c=d.exec(b),h(a)}return c}function d(a){var b=null;if(g(a)&&f(a)){var c=j[a];b=c.exec("SELECT * FROM "+a)}return b}function e(a){return fs.existsSync(i(a))}function f(a){return j&&j[a]&&j[a].db}function g(a){if(f(a))return!0;try{var b=fs.readFileSync(i(a));return j[a]=new SQL.Database(b),!0}catch(c){return!1}}function h(a){try{if(f(a)){var b=j[a],c=b["export"](),d=new Buffer(c);fs.writeFileSync(i(a),d)}}catch(e){}finally{return}}function i(a){return path.resolve(__dirname,"database",a)}var j=[];return{filter:b,execute:c,table:d,create:a}}]);var angular=require("angular");angular.module("app.filter",[]).filter("filetype",[function(){return function(a,b){b=b.split(",");var c=a.match(/\.([\w\W]+)/)[1];return b.indexOf(c)>-1}}]);var angular=require("angular"),angularAnimiate=require("angular-animate"),angularAria=require("angular-aria"),angularMaterial=require("angular-material"),angularMdIcons=require("angular-material-icons"),app=angular.module("app",[angularAnimiate,angularAria,angularMaterial,angularMdIcons,"app.router","app.directive","app.controller","app.database","app.config","app.service","app.filter"]);app.run(["$rootScope","$state","$mdColors","settingService","templateService",function(a,b,c,d,e){a.mdPrimaryColor=c.getThemeColor("pink"),d.init(),e.init()}]),app.bootstrap=function(){angular.bootstrap(window.document,["app"])},app.bootstrap();